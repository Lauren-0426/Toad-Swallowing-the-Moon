<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>èŸ¾èœåæœˆ</title>
    <style>
        /* æç®€æ ·å¼ï¼Œç¡®ä¿ä¸æŠ¥é”™ */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* ç¦æ­¢æ»šåŠ¨ */
            background-color: #000; /* å¼ºåˆ¶é»‘è‰²èƒŒæ™¯ */
            font-family: sans-serif; /* ä½¿ç”¨ç³»ç»Ÿé»˜è®¤å­—ä½“ */
            touch-action: none; /* ç¦æ­¢è§¦æ‘¸é»˜è®¤è¡Œä¸º */
        }
        canvas {
            display: block;
        }
        /* ç®€å•çš„UIæ ·å¼ */
        .ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .box {
            background: rgba(20, 20, 40, 0.9);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ffd700;
            text-align: center;
            color: white;
            pointer-events: auto; /* å…è®¸ç‚¹å‡»æŒ‰é’® */
            max-width: 80%;
        }
        h1 { margin: 0 0 10px 0; color: #ffd700; }
        p { margin: 10px 0; font-size: 14px; }
        button {
            background: #ffd700;
            border: none;
            padding: 10px 20px;
            font-size: 18px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 10px;
        }
        .hud {
            position: absolute;
            top: 10px; left: 10px; right: 10px;
            display: flex;
            justify-content: space-between;
            color: white;
            font-size: 16px;
            pointer-events: none;
            z-index: 5;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- æ¸¸æˆç”»é¢ -->
    <canvas id="gameCanvas"></canvas>

    <!-- é¡¶éƒ¨ä¿¡æ¯ -->
    <div class="hud">
        <span id="levelText">å…³å¡: 1/3</span>
        <span id="scoreText">åˆ†æ•°: 0</span>
    </div>

    <!-- å¼€å§‹ç•Œé¢ -->
    <div id="startScreen" class="ui-layer">
        <div class="box">
            <h1>èŸ¾èœåæœˆ</h1>
            <p>åƒæ‰æœˆäº®ï¼Œèº²é¿é™¨çŸ³ã€‚<br>æ‰‹æœºï¼šæŒ‰ä½å±å¹•ç§»åŠ¨ã€‚<br>ç”µè„‘ï¼šWASDæˆ–æ–¹å‘é”®ã€‚</p>
            <button onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
        </div>
    </div>

    <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
    <div id="gameOverScreen" class="ui-layer hidden">
        <div class="box">
            <h1 style="color: #ff4444;">æ¸¸æˆç»“æŸ</h1>
            <p>ä½ æ’åˆ°äº†é™¨çŸ³ï¼</p>
            <button onclick="startGame()">é‡æ¥</button>
        </div>
    </div>

    <!-- èƒœåˆ©ç•Œé¢ -->
    <div id="winScreen" class="ui-layer hidden">
        <div class="box">
            <h1 style="color: #a29bfe;">èƒœåˆ©ï¼</h1>
            <p>èŸ¾èœæ‰è¿›äº†é»‘æ´ï¼Œæ—…ç¨‹ç»“æŸã€‚</p>
            <p id="finalScore">å¾—åˆ†: 0</p>
            <button onclick="startGame()">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        // è·å–å…ƒç´ 
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const winScreen = document.getElementById('winScreen');
        const levelText = document.getElementById('levelText');
        const scoreText = document.getElementById('scoreText');
        const finalScore = document.getElementById('finalScore');

        // æ¸¸æˆå˜é‡
        let gameState = 'START'; // START, PLAYING, WIN, GAMEOVER
        let level = 1;
        let score = 0;
        let animationId;
        
        // å®ä½“
        let toad = { x: 0, y: 0, size: 20, angle: 0 };
        let moon = { x: 0, y: 0, radius: 30, pulse: 0 };
        let asteroids = [];
        let blackHole = { active: false, radius: 0 };

        // è¾“å…¥çŠ¶æ€
        const input = { x: null, y: null, active: false, keys: {} };

        // åˆå§‹åŒ–ç”»å¸ƒå¤§å°
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡

        // è¾“å…¥ç›‘å¬
        window.addEventListener('keydown', e => input.keys[e.key] = true);
        window.addEventListener('keyup', e => input.keys[e.key] = false);

        // è§¦æ‘¸/é¼ æ ‡ç›‘å¬ (æ‰‹æœºç«¯æ ¸å¿ƒ)
        function handleStart(x, y) { input.x = x; input.y = y; input.active = true; }
        function handleMove(x, y) { if(input.active) { input.x = x; input.y = y; } }
        function handleEnd() { input.active = false; }

        canvas.addEventListener('mousedown', e => handleStart(e.clientX, e.clientY));
        canvas.addEventListener('mousemove', e => handleMove(e.clientX, e.clientY));
        canvas.addEventListener('mouseup', handleEnd);
        canvas.addEventListener('touchstart', e => handleStart(e.touches[0].clientX, e.touches[0].clientY), {passive:false});
        canvas.addEventListener('touchmove', e => { handleMove(e.touches[0].clientX, e.touches[0].clientY); e.preventDefault(); }, {passive:false});
        canvas.addEventListener('touchend', handleEnd);

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            winScreen.classList.add('hidden');
            
            level = 1;
            score = 0;
            gameState = 'PLAYING';
            blackHole.active = false;
            
            resetLevel();
            
            if(animationId) cancelAnimationFrame(animationId);
            gameLoop();
        }

        function resetLevel() {
            // é‡ç½®èŸ¾èœä½ç½®
            toad.x = canvas.width / 2;
            toad.y = canvas.height / 2;
            
            // è®¾ç½®å…³å¡éš¾åº¦
            if(level === 1) moon.radius = 40;
            else if(level === 2) moon.radius = 25;
            else moon.radius = 15;

            respawnMoon();
            asteroids = [];
            updateUI();
        }

        function respawnMoon() {
            const pad = 100;
            moon.x = pad + Math.random() * (canvas.width - pad*2);
            moon.y = pad + Math.random() * (canvas.height - pad*2);
        }

        function updateUI() {
            levelText.innerText = `å…³å¡: ${level}/3`;
            scoreText.innerText = `åˆ†æ•°: ${score}`;
        }

        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop() {
            // 1. æ¸…ç©ºç”»å¸ƒ & ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = '#050510';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶ç®€å•çš„æ˜Ÿæ˜ŸèƒŒæ™¯
            ctx.fillStyle = 'white';
            for(let i=0; i<50; i++) {
                // ä¼ªéšæœºæ˜Ÿæ˜Ÿï¼Œä¸éœ€è¦å­˜å‚¨å¯¹è±¡ï¼ŒèŠ‚çœæ€§èƒ½
                let sx = (Math.sin(i * 132.1) * 43758.5453 % 1) * canvas.width;
                if(sx < 0) sx += canvas.width;
                let sy = (Math.cos(i * 453.2) * 1234.5 % 1) * canvas.height;
                if(sy < 0) sy += canvas.height;
                ctx.fillRect(sx, sy, 1, 1);
            }

            if(gameState === 'PLAYING' || gameState === 'WIN') {
                updateLogic();
                drawGame();
            }

            animationId = requestAnimationFrame(gameLoop);
        }

        function updateLogic() {
            // èŸ¾èœç§»åŠ¨
            let dx = 0, dy = 0;
            if(input.keys['w'] || input.keys['ArrowUp']) dy = -1;
            if(input.keys['s'] || input.keys['ArrowDown']) dy = 1;
            if(input.keys['a'] || input.keys['ArrowLeft']) dx = -1;
            if(input.keys['d'] || input.keys['ArrowRight']) dx = 1;

            if(input.active) {
                const diffX = input.x - toad.x;
                const diffY = input.y - toad.y;
                const dist = Math.sqrt(diffX*diffX + diffY*diffY);
                if(dist > 5) {
                    dx = diffX / dist;
                    dy = diffY / dist;
                }
            }

            const speed = 4;
            toad.x += dx * speed;
            toad.y += dy * speed;

            // è¾¹ç•Œé™åˆ¶
            toad.x = Math.max(20, Math.min(canvas.width-20, toad.x));
            toad.y = Math.max(20, Math.min(canvas.height-20, toad.y));

            // ç”Ÿæˆé™¨çŸ³
            if(gameState === 'PLAYING' && Math.random() < 0.02 + (level*0.01)) {
                asteroids.push({
                    x: Math.random() < 0.5 ? -30 : canvas.width + 30,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * (2 + level),
                    vy: (Math.random() - 0.5) * (2 + level),
                    size: 15 + Math.random() * 15
                });
            }

            // æ›´æ–°é™¨çŸ³
            for(let i = asteroids.length - 1; i >= 0; i--) {
                let a = asteroids[i];
                a.x += a.vx;
                a.y += a.vy;

                // ç§»é™¤å‡ºç•Œé™¨çŸ³
                if(a.x < -50 || a.x > canvas.width + 50 || a.y < -50 || a.y > canvas.height + 50) {
                    asteroids.splice(i, 1);
                    continue;
                }

                // ç¢°æ’æ£€æµ‹
                let dist = Math.hypot(toad.x - a.x, toad.y - a.y);
                if(dist < toad.size + a.size - 5) {
                    gameState = 'GAMEOVER';
                    gameOverScreen.classList.remove('hidden');
                }
            }

            // åƒåˆ°æœˆäº®
            let distToMoon = Math.hypot(toad.x - moon.x, toad.y - moon.y);
            if(distToMoon < toad.size + moon.radius) {
                score += 100 * level;
                level++;
                if(level > 3) {
                    gameState = 'WIN';
                    blackHole.active = true;
                    // æ¸…ç©ºé™¨çŸ³
                    asteroids = [];
                } else {
                    resetLevel();
                }
                updateUI();
            }

            // é»‘æ´é€»è¾‘
            if(gameState === 'WIN') {
                blackHole.radius += 2;
                // å¸å…¥èŸ¾èœ
                let cx = canvas.width/2, cy = canvas.height/2;
                let angle = Math.atan2(cy - toad.y, cx - toad.x);
                toad.x += Math.cos(angle) * 5;
                toad.y += Math.sin(angle) * 5;
                toad.angle += 0.2;
                
                // æ£€æµ‹æ˜¯å¦æ‰è¿›å»
                if(Math.hypot(toad.x - cx, toad.y - cy) < 10) {
                    winScreen.classList.remove('hidden');
                    finalScore.innerText = "æœ€ç»ˆå¾—åˆ†: " + score;
                    gameState = 'END'; // åœæ­¢é€»è¾‘æ›´æ–°ä½†ä¿æŒç»˜åˆ¶
                }
            }
        }

        function drawGame() {
            // ç»˜åˆ¶é»‘æ´
            if(blackHole.active) {
                ctx.save();
                ctx.translate(canvas.width/2, canvas.height/2);
                ctx.beginPath();
                ctx.arc(0, 0, blackHole.radius, 0, Math.PI*2);
                ctx.fillStyle = 'black';
                ctx.fill();
                ctx.strokeStyle = '#a29bfe';
                ctx.lineWidth = 5;
                ctx.stroke();
                ctx.restore();
            }

            // ç»˜åˆ¶æœˆäº®
            if(gameState === 'PLAYING') {
                moon.pulse += 0.05;
                let scale = 1 + Math.sin(moon.pulse) * 0.1;
                ctx.save();
                ctx.translate(moon.x, moon.y);
                ctx.scale(scale, scale);
                ctx.font = `${moon.radius*2}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('ğŸŒ™', 0, 0);
                ctx.restore();
            }

            // ç»˜åˆ¶èŸ¾èœ
            ctx.save();
            ctx.translate(toad.x, toad.y);
            if(gameState === 'WIN') {
                ctx.rotate(toad.angle);
                // å˜å°æ•ˆæœ
                let scale = Math.max(0.1, Math.hypot(toad.x - canvas.width/2, toad.y - canvas.height/2)/200);
                ctx.scale(scale, scale);
            }
            ctx.font = '40px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ğŸ¸', 0, 0);
            ctx.restore();

            // ç»˜åˆ¶é™¨çŸ³
            ctx.font = '30px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            for(let a of asteroids) {
                ctx.fillText('ğŸª¨', a.x, a.y);
            }
        }
    </script>
</body>
</html>
